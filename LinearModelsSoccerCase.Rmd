---
title: "SoccerTeamData"
author: "Danilo Nikcevic"
date: "2023-05-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# SoccerTeam - training data 

 Data from the dataset was collected using GPS units on the players while they are training. The file is in .xlsx format and it is very structured and organized. Since there were issues with Makhi Parks and Moses Stephens GPS units on 36th day of training, their data for mentioned day wasn't collected properly and some of columns were filled with '??' which indicates that there is no data available. The task is to deal with these missing values. 

## Predicting missing values
 
 There are many different ways to predict missing values from the dataframe. In the following models you will see that I choose to fill missing values by making Machine Learning models - simple linear regression models. 
 The other techniques that could be used are: mean value, median value or mode value.

## Model Choice

 For the specific task, I tried different combinations of models based on the shape of the data and I decided to use the following combination for my models: 
 Firstly, I am predicting distance column with time and new drill columns since they are available for every row with missing values. 
 Once I get the values for distance column, I use it in the next model alongside with time and new drill columns to predict another column with missing values. I repeat the process and every time I get missing values for new column, I input it in the new model (model for the next column) in order to get better prediction. I do the same process until I get all of the missing values.
 
## Analysis of statistics 
 
 This combination of linear models is my choice because they achieved the highest Adjusted R2 (proportion of variance explained in the dependent variable by independent variables resilient to number of predictors) and the most reasonable results after analysis. 
 
 
 Even if for some models a lot of predictors are not important Pr(>|t|) > 0.05, I still decided to keep them in models because there is no concerning difference between R squared and Adjusted R squared.
 Based on how data is organized, my opinion is that these predictors are important which is confirmed with the increase of Adjusted R squared when I impute them in models.
 
 
I didn't include any evaluation metrics because datasets for targeted players are very small and I think that different times for particular drill (part of training) can bias the evaluation metrics relevancy. 
Instead of evaluating models with MSE, RMSE or MAE, I did observation of new values compared with existing values and for final models they are all excellent fit.





## Loading and preparing data:
```{r}
library(readxl)
###to ignore warnings (they are at the start because of '??' in data which is automatically read as NA)
options(warn = -1)


###Loading data
trainingdata <- read_excel('C:/Users/Asus/OneDrive/Desktop/SoccerTeamData/DataTask.xlsx', sheet = 2)

column_names <- c("Position", "Day", "Date", "NewName", "New.Drill", 'Time.mins.','Distance.m.', 'MaxSpeed.m.s.','High.Decelerations', 'HighSpeed', 'SprintDistance')

colnames(trainingdata) <- column_names

###to get decimals for p-values
options(scipen = 999)


####Making a subset for only Parks/Stephens data
subset_Parks1 <- data.frame(trainingdata[trainingdata$NewName == 'Makhi Parks',])
subset_Stephens1 <- data.frame(trainingdata[trainingdata$NewName == 'Moses Stephens',])


####Dropping data with targeted players from the actual dataset so I can add them again when I get missing values
trainingdata <- subset(trainingdata, !(trainingdata$NewName %in% 'Makhi Parks'))
trainingdata <- subset(trainingdata, !(trainingdata$NewName %in% 'Moses Stephens'))

####Plotting data to see relations and trends
#plot(subset_Parks1)
#plot(subset_Stephens1)
####Omitting NA's (rows with missing values) to train the model with all available data for Parks/Stephens
subset_Parks <- na.omit(subset_Parks1)
subset_Stephens <- na.omit(subset_Stephens1)
```


# Makhi Parks LINEAR MODELS
```{r}
####Creating vectors of available values because it will make it easier to get predictions
Time <- c(60.8300,12.0575,23.2925,2.4850,2.2225,2.3275,3.1850,2.4150)
NewDrill <- c('Full Session', 'Warm Up', 'Tactical','Possession', 'Possession', 'Possession', 'Possession', 'Possession')






####MODELS:
#Approach for models below is to predict the distance by time and drills at first and once I get distance values, I will use it alongside with time and drills for next model to predict missing values for MaxSpeed. Then I will repeat the same process until I get missing values for all columns 

#####First linear model - Predicting Distance with New.Drill and Time.mins. (available data) and entering new values
model_parksDistance <- lm(Distance.m.~Time.mins.+New.Drill, data = subset_Parks)
summary(model_parksDistance)

predictiondata <- data.frame(Time.mins. = Time, New.Drill = NewDrill)

#Making predictions
distancepredictions <- round(predict(model_parksDistance, newdata = predictiondata))
###NOTE THAT I AM USING subset_Parks1 BELOW BECAUSE THAT DATASET CONTAINS NAs. I USE IT AND FILL OUT NAs FOR DISTANCE WITH PREDICTIONS THAT I GOT FROM THE MODEL ABOVE. THE PRACTICE IS THE SAME FOR OTHER MODELS
# Identify the missing values
missing_values <- is.na(subset_Parks1$Distance.m.)
# Replace missing values with the predicted values
subset_Parks1$Distance.m.[missing_values] <- distancepredictions
# Print the predictions
distancepredictions


####Second linear model - Predicting MaxSpeed with data available (New.Drill and Time.mins.) + Distance (calculated from previous model) and entering new values
model_parksMaxSpeed <- lm(MaxSpeed.m.s. ~ Time.mins.+New.Drill+Distance.m., data = subset_Parks)

summary(model_parksMaxSpeed)

predictiondata <- data.frame(Time.mins. = Time, New.Drill = NewDrill, Distance.m. = c(distancepredictions))

# Making predictions
MaxSpeedpredictions <- predict(model_parksMaxSpeed, newdata = predictiondata)
####Since the R-squared is a way lower in comparison to other models, I used new values for purposes of predicting other columns but I didn't input them in my data. Instead of that, I tried to improve summary statistics which you will see at the end of this chunk.  
# Print the predictions
print(MaxSpeedpredictions)


####Third linear model - Predicting High Speed with data available (New.Drill and Time.mins.) + Distance + MaxSpeed (calculated from previous models) and entering new values
model_highspeed <- lm(HighSpeed ~ MaxSpeed.m.s. + Distance.m.+Time.mins.+New.Drill, data = subset_Parks)

summary(model_highspeed)

predictiondata <- data.frame(Time.mins. = Time, Distance.m. = c(distancepredictions),MaxSpeed.m.s. = c(MaxSpeedpredictions), New.Drill =NewDrill)

# Make predictions using the linear model
highspeedpredictions <- round(predict(model_highspeed, newdata = predictiondata))
missing_values <- is.na(subset_Parks1$HighSpeed)
# Replace missing values with new values
subset_Parks1$HighSpeed[missing_values] <- highspeedpredictions
highspeedpredictions

####Fourth linear model - Predicting SprintDistance with data available (New.Drill and Time.mins.) + Distance + MaxSpeed + High Speed (calculated from previous models) and entering new values
model_sprintdistance <- lm(SprintDistance ~ MaxSpeed.m.s. + Distance.m.+Time.mins.+ New.Drill+ HighSpeed, data = subset_Parks)

summary(model_sprintdistance)

predictiondata <- data.frame(Time.mins. = Time, Distance.m. = c(distancepredictions),MaxSpeed.m.s. = c(MaxSpeedpredictions), New.Drill = NewDrill, HighSpeed = c(highspeedpredictions))

# Make predictions using the linear model
sprintdistancepredictions <- round(predict(model_sprintdistance, newdata = predictiondata))

missing_values <- is.na(subset_Parks1$SprintDistance)
# Replace missing values with new values
subset_Parks1$SprintDistance[missing_values] <- sprintdistancepredictions
# Print the predictions
print(sprintdistancepredictions)


####Fifth linear model - Predicting High Decelerations with data available (New.Drill and Time.mins.) + Distance + MaxSpeed + HighSpeedDistance + Sprint Distance (calculated from previous models) and entering new values
model_parksdecel <- lm(High.Decelerations ~ MaxSpeed.m.s. + Distance.m.+Time.mins.+New.Drill+HighSpeed+SprintDistance, data = subset_Parks)

summary(model_parksdecel)


predictiondata <- data.frame(Time.mins. = Time, Distance.m. = c(distancepredictions),MaxSpeed.m.s. = c(MaxSpeedpredictions), New.Drill = NewDrill, HighSpeed = c(highspeedpredictions), SprintDistance = c(sprintdistancepredictions))
# Making predictions
decelpredictions <- round(predict(model_parksdecel, newdata = predictiondata))
missing_values <- is.na(subset_Parks1$High.Decelerations)
# Replace missing values with new values
subset_Parks1$High.Decelerations[missing_values] <- decelpredictions
# Print the predictions
print(decelpredictions)


####Trying to improve MaxSpeed results
improveMaxSpeed <- lm(MaxSpeed.m.s.~ High.Decelerations  + Distance.m. +Time.mins. + HighSpeed + SprintDistance + New.Drill, data = subset_Parks)
summary(improveMaxSpeed)
summary(model_parksMaxSpeed)
####Improved by 11% R2, Residuals error also by 0.6
predictiondata <- data.frame(Time.mins. = Time, Distance.m. = c(distancepredictions),High.Decelerations = c(decelpredictions), New.Drill = NewDrill, HighSpeed = c(highspeedpredictions), SprintDistance = c(sprintdistancepredictions))
# Making predictions
maxspeedpredictions <- round(predict(improveMaxSpeed, newdata = predictiondata), digits = 2)
missing_values <- is.na(subset_Parks1$MaxSpeed.m.s.)
# Replace missing values with new values
subset_Parks1$MaxSpeed.m.s.[missing_values] <- maxspeedpredictions
# Print the predictions
print(maxspeedpredictions)

```

Adding Parks results to the dataframe 
```{r}
trainingdata <- rbind(trainingdata, subset_Parks1)
```


# Moses Stephens LINEAR MODELS
```{r}
Time <- c(60.8300, 2.2225, 2.3275, 3.1850, 2.4150)
NewDrill <- c('Full Session', 'Possession','Possession','Possession','Possession') 

#####First linear model - Predicting Distance with New.Drill and Time.mins. or with data available after the GPS lost of values and entering new values
model_StephensDistance <- lm(Distance.m.~Time.mins.+New.Drill, data = subset_Stephens)
summary(model_StephensDistance)

predictiondata <- data.frame(Time.mins. = Time, New.Drill = NewDrill)

#Making predictions
distancepredictions <- round(predict(model_StephensDistance, newdata = predictiondata))

###NOTE THAT I AM USING subset_Stephens1 HERE BECAUSE THAT DATASET CONTAINS NAs. I USE IT AND FILL OUT NAs FOR DISTANCE WITH PREDICTIONS THAT I GOT FROM THE MODEL ABOVE. THE PRACTICE IS THE SAME FOR OTHER MODELS
missing_values <- is.na(subset_Stephens1$Distance.m.)
# Replace missing values with predicted values
subset_Stephens1$Distance.m.[missing_values] <- distancepredictions
# Print the predictions
distancepredictions


####Second linear model - Predicting MaxSpeed with data available (New.Drill and Time.mins.) + Distance (calculated from previous model) and entering new values
model_StephensMaxSpeed <- lm(MaxSpeed.m.s. ~ Time.mins.+New.Drill+Distance.m., data = subset_Stephens)

summary(model_StephensMaxSpeed)


predictiondata <- data.frame(Time.mins. = Time, New.Drill = NewDrill, Distance.m. = c(distancepredictions))

# Making predictions
MaxSpeedpredictions <- predict(model_StephensMaxSpeed, newdata = predictiondata)

# Print the predictions
print(MaxSpeedpredictions)

####Third linear model - Predicting High Speed with data available (New.Drill and Time.mins.) + Distance + MaxSpeed (calculated from previous models) and entering new values
model_highspeed <- lm(HighSpeed ~ MaxSpeed.m.s. + Distance.m.+Time.mins.+New.Drill, data = subset_Stephens)

summary(model_highspeed)

predictiondata <- data.frame(Time.mins. = Time, Distance.m. = c(distancepredictions),MaxSpeed.m.s. = c(MaxSpeedpredictions), New.Drill =NewDrill)

# Make predictions using the linear model
highspeedpredictions <- round(predict(model_highspeed, newdata = predictiondata))
missing_values <- is.na(subset_Stephens1$HighSpeed)
# Replace missing values with new values
subset_Stephens1$HighSpeed[missing_values] <- highspeedpredictions
# Print the predictions
print(highspeedpredictions)


####Fourth linear model - Predicting SprintDistance with data available (New.Drill and Time.mins.) + Distance + MaxSpeed + High Speed (calculated from previous models) and entering new values
model_sprintdistance <- lm(SprintDistance ~ MaxSpeed.m.s. + Distance.m.+Time.mins.+ New.Drill+ HighSpeed, data = subset_Stephens)

summary(model_sprintdistance)

predictiondata <- data.frame(Time.mins. = Time, Distance.m. = c(distancepredictions),MaxSpeed.m.s. = c(MaxSpeedpredictions), New.Drill = NewDrill, HighSpeed = c(highspeedpredictions))

# Make predictions using the linear model
sprintdistancepredictions <- round(predict(model_sprintdistance, newdata = predictiondata))
missing_values <- is.na(subset_Stephens1$SprintDistance)
# Replace missing values with new values
subset_Stephens1$SprintDistance[missing_values] <- sprintdistancepredictions
# Print the predictions
print(sprintdistancepredictions)


####Fifth linear model - Predicting High Decelerations with data available (New.Drill and Time.mins.) + Distance + MaxSpeed + HighSpeedDistance + Sprint Distance (calculated from previous models) and entering new values
model_decel <- lm(High.Decelerations ~ MaxSpeed.m.s. + Distance.m.+Time.mins.+New.Drill+HighSpeed+SprintDistance, data = subset_Stephens)

summary(model_decel)


predictiondata <- data.frame(Time.mins. = Time, Distance.m. = c(distancepredictions),MaxSpeed.m.s. = c(MaxSpeedpredictions), New.Drill = NewDrill, HighSpeed = c(highspeedpredictions), SprintDistance = c(sprintdistancepredictions))
# Making predictions
decelpredictions <- round(predict(model_decel, newdata = predictiondata))
missing_values <- is.na(subset_Stephens1$High.Decelerations)
# Replace missing values with new values
subset_Stephens1$High.Decelerations[missing_values] <- decelpredictions
# Print the predictions
print(decelpredictions)


####Trying to improve MaxSpeed results
improveMaxSpeed <- lm(MaxSpeed.m.s. ~ Time.mins. + Distance.m. + High.Decelerations + HighSpeed + SprintDistance + New.Drill, data = subset_Stephens)
summary(improveMaxSpeed)


####Improved Adjusted R-squared for about 5% when comparing to the previous model 
predictiondata <- data.frame(Time.mins. = Time, Distance.m. = c(distancepredictions),High.Decelerations = c(decelpredictions), New.Drill = NewDrill, HighSpeed = c(highspeedpredictions), SprintDistance = c(sprintdistancepredictions))
# Making predictions
maxspeedpredictions <- round(predict(improveMaxSpeed, newdata = predictiondata),digits = 2)
missing_values <- is.na(subset_Stephens1$MaxSpeed.m.s.)
# Replace missing values with the input values
subset_Stephens1$MaxSpeed.m.s.[missing_values] <- maxspeedpredictions
# Print the predictions
print(maxspeedpredictions)

```


Adding new values to the dataframe
```{r}
trainingdata <- rbind(trainingdata, subset_Stephens1)
```

# Creating and exporting final dataframe
```{r}
####Ordering data by the day of training
trainingdata <- trainingdata[order(trainingdata$Day), ]
####Final dataset export:
library(openxlsx)
write.xlsx(trainingdata, file = "finaltrainingdataSoccer.xlsx", rowNames = FALSE)
```
All models have very significant summary statistic results; p-value is always a way smaller than 0.05... Proportion of variance explained (Adjusted R squared) is very high. New values are excellent fit in comparison with available values









## Conclusion
The models that utilize all available columns, including time and drills, have demonstrated superior performance compared to models that only use time and drills.

Models are indicating that Distance is highly dependent and very predictable by Time and Drills whereas Maximum Speed and Sprint Distance need more predictors to get accurate results. High Speed and High Decelerations can be decently predicted by time and drills - Adjusted R squared for both players is > 0.59, but if there are more predictors used, models perform way better - Adjusted R squared for both players is >= 0.79. 

The observation of the predicted values compared to the existing values indicates that the final models provide reasonable predictions that align well with the rest of the available data for the players. This suggests that the selected combination of linear models captures the underlying relationships effectively.


The final dataset has been exported to an XLSX file, and the predicted values have been appropriately rounded to align with the structure of the received dataset.

Limitations and biases: Small size of the dataset. This can result in insufficient data to adequately capture the underlying patterns and relationships in the variables. A smaller sample size may not provide enough variability to generalize the results accurately.
Idea to overcome limitations and biases: Generate synthetic data and increase the number of rows in that way. 



Danilo Nikcevic, 29th May 2023
